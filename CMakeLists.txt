CMAKE_MINIMUM_REQUIRED(VERSION 2.8.0)
PROJECT(avuos)

set(TOOLCHAIN_DIR ${CMAKE_SOURCE_DIR}/toolchain/tools/bin/)
set(TOOLCHAIN_PREFIX i686-pc-avuos-)

set(CMAKE_C_COMPILER ${TOOLCHAIN_DIR}${TOOLCHAIN_PREFIX}gcc)
set(CMAKE_CXX_COMPILER ${TOOLCHAIN_DIR}${TOOLCHAIN_PREFIX}g++)
set(CMAKE_LINKER ${TOOLCHAIN_DIR}${TOOLCHAIN_PREFIX}ld)
set(CMAKE_ASM_COMPILER ${TOOLCHAIN_DIR}${TOOLCHAIN_PREFIX}gcc)
set(CMAKE_STRIP ${TOOLCHAIN_DIR}${TOOLCHAIN_PREFIX}strip)
set(CMAKE_AR ${TOOLCHAIN_DIR}${TOOLCHAIN_PREFIX}ar)
set(CMAKE_RANLIB ${TOOLCHAIN_DIR}${TOOLCHAIN_PREFIX}ranlib)

ADD_SUBDIRECTORY(kernel/)

ADD_CUSTOM_TARGET(image
	COMMAND ${CMAKE_COMMAND} -E env "SOURCE_DIR=${CMAKE_SOURCE_DIR}" ${CMAKE_SOURCE_DIR}/scripts/image.sh
	BYPRODUCTS ${CMAKE_BINARY_DIR}/avuOS.img
	USES_TERMINAL
)

ADD_CUSTOM_TARGET(qemu-kernel
	COMMAND ${CMAKE_SOURCE_DIR}/scripts/qemu-kernel.sh
	USES_TERMINAL
)

ADD_CUSTOM_TARGET(qemu-image
	COMMAND ${CMAKE_SOURCE_DIR}/scripts/qemu-image.sh
	USES_TERMINAL
)